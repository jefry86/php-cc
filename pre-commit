#!/bin/sh
a=`git status -s` 

array=(${a//,/ })  
for var in ${array[@]}
do
    if [ "$var" = "M" ] || [ "$var" = "A" ] || [ "$var" = "D" ]; then
        continue
    fi

    # check php file
    if [[ ! $var =~ ".php" ]]; then
        echo "Check file $var: not php file, ignoring..."
    fi

    # phplint
    phplintResult=`./vendor/bin/phplint $var | grep error`
    if [ x"$phplintResult" != x ]; then 
        echo "-------------------------------------"
        echo "Git commit error, get phplint errors:"
        ./vendor/bin/phplint $var | while read line
        do 
            echo $line
        done
        echo "-------------------------------------"
        exit 1
    fi

    # phpcs
    phpcsResult=`phpcs --standard=psr2 $var | grep ERRORS | grep -v "0 ERRORS"`
    if [ x"$phpcsResult" != x ]; then 
        echo "-------------------------------------"
        echo "Git commit error, get phpcs errors:"
        phpcs $var | while read line 
        do 
            echo $line
        done
        echo "-------------------------------------"
        exit 1
    fi
done
echo "Congratulations! Code check success!"
exit 0
